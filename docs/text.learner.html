---

title: Learner for the text application

keywords: fastai
sidebar: home_sidebar

summary: "All the functions necessary to build `Learner` suitable for transfer learning in NLP"
description: "All the functions necessary to build `Learner` suitable for transfer learning in NLP"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/37_text.learner.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The most important functions of this module are <a href="/text.learner#language_model_learner"><code>language_model_learner</code></a> and <a href="/text.learner#text_classifier_learner"><code>text_classifier_learner</code></a>. They will help you define a <a href="/13a_learner#Learner"><code>Learner</code></a> using a pretrained model. See the <a href="http://dev.fast.ai/tutorial.text">text tutorial</a> for exmaples of use.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-a-pretrained-model">Loading a pretrained model<a class="anchor-link" href="#Loading-a-pretrained-model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In text, to load a pretrained model, we need to adapt the embeddings of the vocabulary used for the pre-training to the vocabulary of our current corpus.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="match_embeds" class="doc_header"><code>match_embeds</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>match_embeds</code>(<strong><code>old_wgts</code></strong>, <strong><code>old_vocab</code></strong>, <strong><code>new_vocab</code></strong>)</p>
</blockquote>
<p>Convert the embedding in <code>old_wgts</code> to go from <code>old_vocab</code> to <code>new_vocab</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For words in <code>new_vocab</code> that don't have a corresponding match in <code>old_vocab</code>, we use the mean of all pretrained embeddings.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wgts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0.encoder.weight&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)}</span>
<span class="n">new_wgts</span> <span class="o">=</span> <span class="n">match_embeds</span><span class="p">(</span><span class="n">wgts</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="n">old</span><span class="p">,</span><span class="n">new</span> <span class="o">=</span> <span class="n">wgts</span><span class="p">[</span><span class="s1">&#39;0.encoder.weight&#39;</span><span class="p">],</span><span class="n">new_wgts</span><span class="p">[</span><span class="s1">&#39;0.encoder.weight&#39;</span><span class="p">]</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">old</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">old</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">old</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">old</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_ignore_keys" class="doc_header"><code>load_ignore_keys</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_ignore_keys</code>(<strong><code>model</code></strong>, <strong><code>wgts</code></strong>)</p>
</blockquote>
<p>Load <code>wgts</code> in <code>model</code> ignoring the names of the keys, just taking parameters in order</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TextLearner" class="doc_header"><code>class</code> <code>TextLearner</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L51" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TextLearner</code>(<strong><code>model</code></strong>, <strong><code>dls</code></strong>, <strong><code>alpha</code></strong>=<em><code>2.0</code></em>, <strong><code>beta</code></strong>=<em><code>1.0</code></em>, <strong><code>moms</code></strong>=<em><code>(0.8, 0.7, 0.8)</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>'Adam'</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>'trainable_params'</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>) :: <a href="/13a_learner#Learner"><code>Learner</code></a></p>
</blockquote>
<p>Basic class for a <a href="/13a_learner#Learner"><code>Learner</code></a> in NLP.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Adds a <a href="/callback.rnn#ModelReseter"><code>ModelReseter</code></a> and an <a href="/callback.rnn#RNNRegularizer"><code>RNNRegularizer</code></a> with <code>alpha</code> and <code>beta</code> to the callbacks, the rest is the same as <a href="/13a_learner#Learner"><code>Learner</code></a> init.</p>
<p>This <a href="/13a_learner#Learner"><code>Learner</code></a> adds functionality to the base class:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TextLearner.load_pretrained" class="doc_header"><code>TextLearner.load_pretrained</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TextLearner.load_pretrained</code>(<strong><code>wgts_fname</code></strong>, <strong><code>vocab_fname</code></strong>, <strong><code>model</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Load a pretrained model and adapt it to the data vocabulary.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>wgts_fname</code> should point to the weights of the pretrained model and <code>vocab_fname</code> to the vocabulary used to pretrain it.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TextLearner.save_encoder" class="doc_header"><code>TextLearner.save_encoder</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L57" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TextLearner.save_encoder</code>(<strong><code>file</code></strong>)</p>
</blockquote>
<p>Save the encoder to <code>file</code> in the model directory</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model directory is <a href="/13a_learner#Learner.path/Learner.model_dir"><code>Learner.path/Learner.model_dir</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TextLearner.load_encoder" class="doc_header"><code>TextLearner.load_encoder</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L64" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TextLearner.load_encoder</code>(<strong><code>file</code></strong>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Load the encoder <code>file</code> from the model directory, optionally ensuring it's on <code>device</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Language-modeling-predictions">Language modeling predictions<a class="anchor-link" href="#Language-modeling-predictions"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For language modeling, the predict method is quite different form the other applications, which is why it needs its own subclass.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="decode_spec_tokens" class="doc_header"><code>decode_spec_tokens</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>decode_spec_tokens</code>(<strong><code>tokens</code></strong>)</p>
</blockquote>
<p>Decode the special tokens in <code>tokens</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">decode_spec_tokens</span><span class="p">([</span><span class="s1">&#39;xxmaj&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">]),</span> <span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">decode_spec_tokens</span><span class="p">([</span><span class="s1">&#39;xxup&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">]),</span> <span class="p">[</span><span class="s1">&#39;TEXT&#39;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">decode_spec_tokens</span><span class="p">([</span><span class="s1">&#39;xxrep&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]),</span> <span class="p">[</span><span class="s1">&#39;aaa&#39;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">decode_spec_tokens</span><span class="p">([</span><span class="s1">&#39;xxwrep&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">]),</span> <span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="LMLearner" class="doc_header"><code>class</code> <code>LMLearner</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L109" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>LMLearner</code>(<strong><code>model</code></strong>, <strong><code>dls</code></strong>, <strong><code>alpha</code></strong>=<em><code>2.0</code></em>, <strong><code>beta</code></strong>=<em><code>1.0</code></em>, <strong><code>moms</code></strong>=<em><code>(0.8, 0.7, 0.8)</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>'Adam'</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>'trainable_params'</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>) :: <a href="/text.learner#TextLearner"><code>TextLearner</code></a></p>
</blockquote>
<p>Add functionality to <a href="/text.learner#TextLearner"><code>TextLearner</code></a> when dealingwith a language model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="LMLearner.predict" class="doc_header"><code>LMLearner.predict</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>LMLearner.predict</code>(<strong><code>text</code></strong>, <strong><code>n_words</code></strong>=<em><code>1</code></em>, <strong><code>no_unk</code></strong>=<em><code>True</code></em>, <strong><code>temperature</code></strong>=<em><code>1.0</code></em>, <strong><code>min_p</code></strong>=<em><code>None</code></em>, <strong><code>no_bar</code></strong>=<em><code>False</code></em>, <strong><code>decoder</code></strong>=<em><code>'decode_spec_tokens'</code></em>)</p>
</blockquote>
<p>Return <a href="/text"><code>text</code></a> and the <code>n_words</code> that come after</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The words are picked randomly among the predictions, depending on the probability of each index. <code>no_unk</code> means we never pick the <code>UNK</code> token, <code>tempreature</code> is applied to the predictions, if <code>min_p</code> is passed, we don't consider the indices with a probability lower than it. Set <code>no_bar</code> to <code>True</code> if you don't want any progress bar, and you can pass a long a custom <code>decoder</code> to process the predicted tokens.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Learner-convenience-functions"><a href="/13a_learner#Learner"><code>Learner</code></a> convenience functions<a class="anchor-link" href="#Learner-convenience-functions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="language_model_learner" class="doc_header"><code>language_model_learner</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L147" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>language_model_learner</code>(<strong><code>dls</code></strong>, <strong><code>arch</code></strong>, <strong><code>config</code></strong>=<em><code>None</code></em>, <strong><code>drop_mult</code></strong>=<em><code>1.0</code></em>, <strong><code>pretrained</code></strong>=<em><code>True</code></em>, <strong><code>pretrained_fnames</code></strong>=<em><code>None</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>'Adam'</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>'trainable_params'</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>)</p>
</blockquote>
<p>Create a <a href="/13a_learner#Learner"><code>Learner</code></a> with a language model from <code>dls</code> and <code>arch</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can use the <code>config</code> to customize the architecture used (change the values from <a href="/text.models.awdlstm#awd_lstm_lm_config"><code>awd_lstm_lm_config</code></a> for this), <code>pretrained</code> will use fastai's pretrained model for this <code>arch</code> (if available) or you can pass specific <code>pretrained_fnames</code> containing your own pretrained model and the corresponding vocabulary. All other arguments are passed to <a href="/13a_learner#Learner"><code>Learner</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMDB_SAMPLE</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;texts.csv&#39;</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">TextDataLoaders</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">text_col</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">is_lm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">valid_col</span><span class="o">=</span><span class="s1">&#39;is_valid&#39;</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">language_model_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;This movie is about&#39;</span><span class="p">,</span> <span class="n">n_words</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="text_classifier_learner" class="doc_header"><code>text_classifier_learner</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/learner.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>text_classifier_learner</code>(<strong><code>dls</code></strong>, <strong><code>arch</code></strong>, <strong><code>seq_len</code></strong>=<em><code>72</code></em>, <strong><code>config</code></strong>=<em><code>None</code></em>, <strong><code>pretrained</code></strong>=<em><code>True</code></em>, <strong><code>drop_mult</code></strong>=<em><code>0.5</code></em>, <strong><code>n_out</code></strong>=<em><code>None</code></em>, <strong><code>lin_ftrs</code></strong>=<em><code>None</code></em>, <strong><code>ps</code></strong>=<em><code>None</code></em>, <strong><code>max_len</code></strong>=<em><code>1440</code></em>, <strong><code>y_range</code></strong>=<em><code>None</code></em>, <strong><code>loss_func</code></strong>=<em><code>None</code></em>, <strong><code>opt_func</code></strong>=<em><code>'Adam'</code></em>, <strong><code>lr</code></strong>=<em><code>0.001</code></em>, <strong><code>splitter</code></strong>=<em><code>'trainable_params'</code></em>, <strong><code>cbs</code></strong>=<em><code>None</code></em>, <strong><code>metrics</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>None</code></em>, <strong><code>model_dir</code></strong>=<em><code>'models'</code></em>, <strong><code>wd</code></strong>=<em><code>None</code></em>, <strong><code>wd_bn_bias</code></strong>=<em><code>False</code></em>, <strong><code>train_bn</code></strong>=<em><code>True</code></em>, <strong><code>moms</code></strong>=<em><code>(0.95, 0.85, 0.95)</code></em>)</p>
</blockquote>
<p>Create a <a href="/13a_learner#Learner"><code>Learner</code></a> with a text classifier from <code>dls</code> and <code>arch</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can use the <code>config</code> to customize the architecture used (change the values from <a href="/text.models.awdlstm#awd_lstm_clas_config"><code>awd_lstm_clas_config</code></a> for this), <code>pretrained</code> will use fastai's pretrained model for this <code>arch</code> (if available). <code>drop_mult</code> is a global multiplier applied to control all dropouts. <code>n_out</code> is usually infered from the <code>dls</code> but you may pass it.</p>
<p>The model uses a <a href="/text.models.core#SentenceEncoder"><code>SentenceEncoder</code></a>, which means the texts are passed <code>seq_len</code> tokens at a time, and will only compute the gradients on the last <code>max_len</code> steps. <code>lin_ftrs</code> and <code>ps</code> are passed to <a href="/text.models.core#get_text_classifier"><code>get_text_classifier</code></a>.</p>
<p>All other arguments are passed to <a href="/13a_learner#Learner"><code>Learner</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMDB_SAMPLE</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;texts.csv&#39;</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">TextDataLoaders</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">text_col</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">valid_col</span><span class="o">=</span><span class="s1">&#39;is_valid&#39;</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">text_classifier_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

