---

title: train
keywords: fastai
sidebar: home_sidebar

summary: "Extensions to Learner that easily implement Callback"
---
<!--


#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: docs_src/train.ipynb
# instructions: https://docs.fast.ai/gen_doc_main.html

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Additional-training-functions">Additional training functions<a class="anchor-link" href="#Additional-training-functions">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/train.html#train"><code>train</code></a> provides a number of extension methods that are added to <a href="/basic_train.html#Learner"><code>Learner</code></a> (see below for a list and details), along with three simple callbacks:</p>
<ul>
<li><a href="/train.html#ShowGraph"><code>ShowGraph</code></a></li>
<li><a href="/train.html#GradientClipping"><code>GradientClipping</code></a></li>
<li><a href="/train.html#BnFreeze"><code>BnFreeze</code></a></li>
<li><a href="/train.html#AccumulateScheduler"><code>AccumulateScheduler</code></a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Learner-extension-methods"><a href="/basic_train.html#Learner"><code>Learner</code></a> extension methods<a class="anchor-link" href="#Learner-extension-methods">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These methods are automatically added to all <a href="/basic_train.html#Learner"><code>Learner</code></a> objects created after importing this module. They provide convenient access to a number of callbacks, without requiring them to be manually created.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fit_one_cycle" class="doc_header"><code>fit_one_cycle</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L15" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#fit_one_cycle-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>fit_one_cycle</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>cyc_len</code></strong>:<code>int</code>, <strong><code>max_lr</code></strong>:<code>Union</code>[<code>float</code>, <code>Collection</code>[<code>float</code>], <code>slice</code>]=<strong><em><code>slice(None, 0.003, None)</code></em></strong>, <strong><code>moms</code></strong>:<code>Point</code>=<strong><em><code>(0.95, 0.85)</code></em></strong>, <strong><code>div_factor</code></strong>:<code>float</code>=<strong><em><code>25.0</code></em></strong>, <strong><code>pct_start</code></strong>:<code>float</code>=<strong><em><code>0.3</code></em></strong>, <strong><code>final_div</code></strong>:<code>float</code>=<strong><em><code>None</code></em></strong>, <strong><code>wd</code></strong>:<code>float</code>=<strong><em><code>None</code></em></strong>, <strong><code>callbacks</code></strong>:<code>Optional</code>[<code>Collection</code>[<a href="/callback.html#Callback"><code>Callback</code></a>]]=<strong><em><code>None</code></em></strong>, <strong><code>tot_epochs</code></strong>:<code>int</code>=<strong><em><code>None</code></em></strong>, <strong><code>start_epoch</code></strong>:<code>int</code>=<strong><em><code>None</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="fit_one_cycle-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#fit_one_cycle-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>fit_one_cycle</code>:</p><ul><li><code>pytest -sv tests/test_train.py::test_fit_one_cycle</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_train.py#L36" class="source_link" style="float:right">[source]</a></li></ul><p>Some other tests where <code>fit_one_cycle</code> is used:</p><ul><li><code>pytest -sv tests/test_tabular_train.py::test_empty_cont</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_tabular_train.py#L71" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_text_train.py::test_qrnn_works_if_split_fn_provided</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_text_train.py#L73" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_text_train.py::test_qrnn_works_with_no_split</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_text_train.py#L61" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Fit a model following the 1cycle policy.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="one_cycle_scheduler" class="doc_header"><code>one_cycle_scheduler</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L11" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#one_cycle_scheduler-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>one_cycle_scheduler</code>(<strong><code>lr_max</code></strong>:<code>float</code>, <strong>**<code>kwargs</code></strong>:<code>Any</code>) â†’ <a href="/callbacks.one_cycle.html#OneCycleScheduler"><code>OneCycleScheduler</code></a></p>
</blockquote>
<div class="collapse" id="one_cycle_scheduler-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#one_cycle_scheduler-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>one_cycle_scheduler</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Instantiate a <a href="/callbacks.one_cycle.html#OneCycleScheduler"><code>OneCycleScheduler</code></a> with <code>lr_max</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See <a href="/callbacks.one_cycle.html#OneCycleScheduler"><code>OneCycleScheduler</code></a> for details.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lr_find" class="doc_header"><code>lr_find</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L33" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#lr_find-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>lr_find</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>start_lr</code></strong>:<code>Floats</code>=<strong><em><code>1e-07</code></em></strong>, <strong><code>end_lr</code></strong>:<code>Floats</code>=<strong><em><code>10</code></em></strong>, <strong><code>num_it</code></strong>:<code>int</code>=<strong><em><code>100</code></em></strong>, <strong><code>stop_div</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>wd</code></strong>:<code>float</code>=<strong><em><code>None</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="lr_find-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#lr_find-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>lr_find</code>:</p><ul><li><code>pytest -sv tests/test_train.py::test_lr_find</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_train.py#L16" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_vision_train.py::test_lrfind</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L84" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Explore lr from <code>start_lr</code> to <code>end_lr</code> over <code>num_it</code> iterations in <code>learn</code>. If <code>stop_div</code>, stops when loss diverges.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See <a href="/callbacks.lr_finder.html#LRFinder"><code>LRFinder</code></a> for details.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_fp16" class="doc_header"><code>to_fp16</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L43" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#to_fp16-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>to_fp16</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>loss_scale</code></strong>:<code>float</code>=<strong><em><code>None</code></em></strong>, <strong><code>max_noskip</code></strong>:<code>int</code>=<strong><em><code>1000</code></em></strong>, <strong><code>dynamic</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>clip</code></strong>:<code>float</code>=<strong><em><code>None</code></em></strong>, <strong><code>flat_master</code></strong>:<code>bool</code>=<strong><em><code>False</code></em></strong>, <strong><code>max_scale</code></strong>:<code>float</code>=<strong><em><code>16777216</code></em></strong>, <strong><code>loss_fp32</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>) â†’ <a href="/basic_train.html#Learner"><code>Learner</code></a></p>
</blockquote>
<div class="collapse" id="to_fp16-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#to_fp16-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>to_fp16</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Put <code>learn</code> in FP16 precision mode.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See <a href="/callbacks.fp16.html#MixedPrecision"><code>MixedPrecision</code></a> for details.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_fp32" class="doc_header"><code>to_fp32</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L54" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#to_fp32-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>to_fp32</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>)</p>
</blockquote>
<div class="collapse" id="to_fp32-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#to_fp32-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>to_fp32</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Put <code>learn</code> back to FP32 precision mode.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mixup" class="doc_header"><code>mixup</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L62" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#mixup-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>mixup</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>alpha</code></strong>:<code>float</code>=<strong><em><code>0.4</code></em></strong>, <strong><code>stack_x</code></strong>:<code>bool</code>=<strong><em><code>False</code></em></strong>, <strong><code>stack_y</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>) â†’ <a href="/basic_train.html#Learner"><code>Learner</code></a></p>
</blockquote>
<div class="collapse" id="mixup-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#mixup-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>mixup</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Add mixup <a href="https://arxiv.org/abs/1710.09412">https://arxiv.org/abs/1710.09412</a> to <code>learn</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See <a href="/callbacks.mixup.html#MixUpCallback"><code>MixUpCallback</code></a> for more details.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Interpretation" class="doc_header"><code>class</code> <code>Interpretation</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L146" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Interpretation-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>Interpretation</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>preds</code></strong>:<code>Tensor</code>, <strong><code>y_true</code></strong>:<code>Tensor</code>, <strong><code>losses</code></strong>:<code>Tensor</code>, <strong><code>ds_type</code></strong>:<a href="/basic_data.html#DatasetType"><code>DatasetType</code></a>=<strong><em><code>&lt;DatasetType.Valid: 2&gt;</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="Interpretation-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Interpretation-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>Interpretation</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Interpretation base class, can be inherited for task specific Interpretation classes</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Interpretation.from_learner" class="doc_header"><code>from_learner</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L157" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Interpretation-from_learner-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>from_learner</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>ds_type</code></strong>:<a href="/basic_data.html#DatasetType"><code>DatasetType</code></a>=<strong><em><code>&lt;DatasetType.Valid: 2&gt;</code></em></strong>, <strong><code>activ</code></strong>:<a href="https://pytorch.org/docs/stable/nn.html#torch.nn.Module"><code>Module</code></a>=<strong><em><code>None</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="Interpretation-from_learner-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Interpretation-from_learner-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>from_learner</code>:</p><p>Some other tests where <code>from_learner</code> is used:</p><ul><li><code>pytest -sv tests/test_tabular_train.py::test_confusion_tabular</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_tabular_train.py#L84" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_vision_train.py::test_ClassificationInterpretation</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L95" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_vision_train.py::test_interp</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L72" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Gets preds, y_true, losses to construct base class from a learner</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Interpretation.top_losses" class="doc_header"><code>top_losses</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L163" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Interpretation-top_losses-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>top_losses</code>(<strong><code>k</code></strong>:<code>int</code>=<strong><em><code>None</code></em></strong>, <strong><code>largest</code></strong>=<strong><em><code>True</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="Interpretation-top_losses-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Interpretation-top_losses-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>top_losses</code>:</p><p>Some other tests where <code>top_losses</code> is used:</p><ul><li><code>pytest -sv tests/test_vision_train.py::test_interp</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L72" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_vision_train.py::test_interp_shortcut</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L78" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p><code>k</code> largest(/smallest) losses and indexes, defaulting to all losses (sorted by <code>largest</code>).</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For example in <a href="/train.html#ClassificationInterpretation"><code>ClassificationInterpretation</code></a> is implemented using argmax on preds to set <code>self.pred_class</code> whereas an optional sigmoid is used for <code>MultilabelClassificationInterpretation</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ClassificationInterpretation" class="doc_header"><code>class</code> <code>ClassificationInterpretation</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L173" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ClassificationInterpretation-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>ClassificationInterpretation</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>preds</code></strong>:<code>Tensor</code>, <strong><code>y_true</code></strong>:<code>Tensor</code>, <strong><code>losses</code></strong>:<code>Tensor</code>, <strong><code>ds_type</code></strong>:<a href="/basic_data.html#DatasetType"><code>DatasetType</code></a>=<strong><em><code>&lt;DatasetType.Valid: 2&gt;</code></em></strong>) :: <a href="/train.html#Interpretation"><code>Interpretation</code></a></p>
</blockquote>
<div class="collapse" id="ClassificationInterpretation-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ClassificationInterpretation-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>ClassificationInterpretation</code>:</p><ul><li><code>pytest -sv tests/test_vision_train.py::test_ClassificationInterpretation</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L95" class="source_link" style="float:right">[source]</a></li></ul><p>Some other tests where <code>ClassificationInterpretation</code> is used:</p><ul><li><code>pytest -sv tests/test_tabular_train.py::test_confusion_tabular</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_tabular_train.py#L84" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_vision_train.py::test_interp</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L72" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Interpretation methods for classification models.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_SAMPLE</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ImageDataBunch</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">preds</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">losses</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">(</span><span class="n">with_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">interp</span> <span class="o">=</span> <span class="n">ClassificationInterpretation</span><span class="p">(</span><span class="n">learn</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">losses</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Interpretation.top_losses" class="doc_header"><code>top_losses</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L163" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#Interpretation-top_losses-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>top_losses</code>(<strong><code>k</code></strong>:<code>int</code>=<strong><em><code>None</code></em></strong>, <strong><code>largest</code></strong>=<strong><em><code>True</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="Interpretation-top_losses-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#Interpretation-top_losses-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>top_losses</code>:</p><p>Some other tests where <code>top_losses</code> is used:</p><ul><li><code>pytest -sv tests/test_vision_train.py::test_interp</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L72" class="source_link" style="float:right">[source]</a></li><li><code>pytest -sv tests/test_vision_train.py::test_interp_shortcut</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L78" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p><code>k</code> largest(/smallest) losses and indexes, defaulting to all losses (sorted by <code>largest</code>).</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Returns tuple of <em>(losses,indices)</em>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.return_types.topk(
values=tensor([14.2152, 10.3850,  9.1650,  8.7286,  5.8163,  5.6689,  4.9013,  4.5471,
         4.2432]),
indices=tensor([1059,  299,  960, 1831, 1775, 1467,  750, 1892,  634]))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ClassificationInterpretation.plot_confusion_matrix" class="doc_header"><code>plot_confusion_matrix</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L191" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ClassificationInterpretation-plot_confusion_matrix-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>plot_confusion_matrix</code>(<strong><code>normalize</code></strong>:<code>bool</code>=<strong><em><code>False</code></em></strong>, <strong><code>title</code></strong>:<code>str</code>=<strong><em><code>'Confusion matrix'</code></em></strong>, <strong><code>cmap</code></strong>:<code>Any</code>=<strong><em><code>'Blues'</code></em></strong>, <strong><code>slice_size</code></strong>:<code>int</code>=<strong><em><code>1</code></em></strong>, <strong><code>norm_dec</code></strong>:<code>int</code>=<strong><em><code>2</code></em></strong>, <strong><code>plot_txt</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>return_fig</code></strong>:<code>bool</code>=<strong><em><code>None</code></em></strong>, <strong>**<code>kwargs</code></strong>) â†’ <code>Optional</code>[<code>Figure</code>]</p>
</blockquote>
<div class="collapse" id="ClassificationInterpretation-plot_confusion_matrix-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ClassificationInterpretation-plot_confusion_matrix-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>plot_confusion_matrix</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Plot the confusion matrix, with <code>title</code> and using <code>cmap</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If <a href="/vision.data.html#normalize"><code>normalize</code></a>, plots the percentages with <code>norm_dec</code> digits. <code>slice_size</code> can be used to avoid out of memory error if your set is too big. <code>kwargs</code> are passed to <code>plt.figure</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ClassificationInterpretation.confusion_matrix" class="doc_header"><code>confusion_matrix</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L179" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ClassificationInterpretation-confusion_matrix-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>confusion_matrix</code>(<strong><code>slice_size</code></strong>:<code>int</code>=<strong><em><code>1</code></em></strong>)</p>
</blockquote>
<div class="collapse" id="ClassificationInterpretation-confusion_matrix-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ClassificationInterpretation-confusion_matrix-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>confusion_matrix</code>:</p><ul><li><code>pytest -sv tests/test_tabular_train.py::test_confusion_tabular</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_tabular_train.py#L84" class="source_link" style="float:right">[source]</a></li></ul><p>Some other tests where <code>confusion_matrix</code> is used:</p><ul><li><code>pytest -sv tests/test_vision_train.py::test_ClassificationInterpretation</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L95" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Confusion matrix as an <code>np.ndarray</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[989,  21],
       [ 40, 988]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ClassificationInterpretation.most_confused" class="doc_header"><code>most_confused</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L219" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ClassificationInterpretation-most_confused-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>most_confused</code>(<strong><code>min_val</code></strong>:<code>int</code>=<strong><em><code>1</code></em></strong>, <strong><code>slice_size</code></strong>:<code>int</code>=<strong><em><code>1</code></em></strong>) â†’ <code>Collection</code>[<code>Tuple</code>[<code>str</code>, <code>str</code>, <code>int</code>]]</p>
</blockquote>
<div class="collapse" id="ClassificationInterpretation-most_confused-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ClassificationInterpretation-most_confused-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>Tests found for <code>most_confused</code>:</p><p>Some other tests where <code>most_confused</code> is used:</p><ul><li><code>pytest -sv tests/test_vision_train.py::test_ClassificationInterpretation</code> <a href="https://github.com/fastai/fastai/blob/master/tests/test_vision_train.py#L95" class="source_link" style="float:right">[source]</a></li></ul><p>To run tests please refer to this <a href="/dev/test.html#quick-guide">guide</a>.</p></div></div><p>Sorted descending list of largest non-diagonal entries of confusion matrix, presented as actual, predicted, number of occurrences.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiLabelClassificationInterpretation" class="doc_header"><code>class</code> <code>MultiLabelClassificationInterpretation</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L233" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#MultiLabelClassificationInterpretation-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>MultiLabelClassificationInterpretation</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>preds</code></strong>:<code>Tensor</code>, <strong><code>y_true</code></strong>:<code>Tensor</code>, <strong><code>losses</code></strong>:<code>Tensor</code>, <strong><code>ds_type</code></strong>:<a href="/basic_data.html#DatasetType"><code>DatasetType</code></a>=<strong><em><code>&lt;DatasetType.Valid: 2&gt;</code></em></strong>, <strong><code>sigmoid</code></strong>:<code>bool</code>=<strong><em><code>True</code></em></strong>, <strong><code>thresh</code></strong>:<code>float</code>=<strong><em><code>0.3</code></em></strong>) :: <a href="/train.html#Interpretation"><code>Interpretation</code></a></p>
</blockquote>
<div class="collapse" id="MultiLabelClassificationInterpretation-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#MultiLabelClassificationInterpretation-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>MultiLabelClassificationInterpretation</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Interpretation methods for classification models.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<div markdown="span" class="alert alert-danger" role="alert"><i class="fa fa-danger-circle"></i> <b>Warning: </b>MultiLabelClassificationInterpretation is not implemented yet. Feel free to implement it :)</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Working-with-large-datasets">Working with large datasets<a class="anchor-link" href="#Working-with-large-datasets">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When working with large datasets, memory problems can arise when computing the confusion matrix. For example, an error can look like this:</p>

<pre><code>RuntimeError: $ Torch: not enough memory: you tried to allocate 64GB. Buy new RAM!

</code></pre>
<p>In this case it is possible to force <a href="/train.html#ClassificationInterpretation"><code>ClassificationInterpretation</code></a> to compute the confusion matrix for data slices and then aggregate the result by specifying slice_size parameter.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">slice_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[989,  21],
       [ 40, 988]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">slice_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">most_confused</span><span class="p">(</span><span class="n">slice_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;7&#39;, &#39;3&#39;, 40), (&#39;3&#39;, &#39;7&#39;, 21)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Additional-callbacks">Additional callbacks<a class="anchor-link" href="#Additional-callbacks">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll show examples below using our MNIST sample. As usual the <code>on_something</code> methods are directly called by the fastai library, no need to call them yourself.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST_SAMPLE</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ImageDataBunch</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="ShowGraph" class="doc_header"><code>class</code> <code>ShowGraph</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L74" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ShowGraph-pytest" style="float:right; padding-right:10px">[test]</a></h3><blockquote><p><code>ShowGraph</code>(<strong><code>learn</code></strong>) :: <a href="/basic_train.html#LearnerCallback"><code>LearnerCallback</code></a></p>
</blockquote>
<div class="collapse" id="ShowGraph-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ShowGraph-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>ShowGraph</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Update a graph of learner stats and metrics after each epoch.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">callback_fns</span><span class="o">=</span><span class="n">ShowGraph</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="imgs/train_graph.gif" alt="Training graph"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ShowGraph.on_epoch_end" class="doc_header"><code>on_epoch_end</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L76" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#ShowGraph-on_epoch_end-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_epoch_end</code>(<strong><code>n_epochs</code></strong>:<code>int</code>, <strong><code>last_metrics</code></strong>:<code>MetricsList</code>, <strong>**<code>kwargs</code></strong>) â†’ <code>bool</code></p>
</blockquote>
<div class="collapse" id="ShowGraph-on_epoch_end-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#ShowGraph-on_epoch_end-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_epoch_end</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>If we have <code>last_metrics</code> plot them in our pbar graph</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="GradientClipping" class="doc_header"><code>class</code> <code>GradientClipping</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L93" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#GradientClipping-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>GradientClipping</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>clip</code></strong>:<code>float</code>=<strong><em><code>0.0</code></em></strong>) :: <a href="/basic_train.html#LearnerCallback"><code>LearnerCallback</code></a></p>
</blockquote>
<div class="collapse" id="GradientClipping-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#GradientClipping-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>GradientClipping</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Gradient clipping during training.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span>
    <span class="n">callback_fns</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">GradientClipping</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.162001</td>
      <td>0.100777</td>
      <td>0.971050</td>
      <td>00:07</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="GradientClipping.on_backward_end" class="doc_header"><code>on_backward_end</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L99" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#GradientClipping-on_backward_end-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_backward_end</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<div class="collapse" id="GradientClipping-on_backward_end-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#GradientClipping-on_backward_end-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_backward_end</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Clip the gradient before the optimizer step.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BnFreeze" class="doc_header"><code>class</code> <code>BnFreeze</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L87" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#BnFreeze-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>BnFreeze</code>(<strong><code>learn</code></strong>) :: <a href="/basic_train.html#LearnerCallback"><code>LearnerCallback</code></a></p>
</blockquote>
<div class="collapse" id="BnFreeze-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#BnFreeze-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>BnFreeze</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Freeze moving average statistics in all non-trainable batchnorm layers.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For batchnorm layers where <code>requires_grad==False</code>, you generally don't want to update their moving average statistics, in order to avoid the model's statistics getting out of sync with its pre-trained weights. You can add this callback to automate this freezing of statistics (internally, it calls <code>eval</code> on these layers).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet18</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">callback_fns</span><span class="o">=</span><span class="n">BnFreeze</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.163550</td>
      <td>0.094137</td>
      <td>0.971541</td>
      <td>00:06</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BnFreeze.on_epoch_begin" class="doc_header"><code>on_epoch_begin</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L89" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#BnFreeze-on_epoch_begin-pytest" style="float:right; padding-right:10px">[test]</a></h4><blockquote><p><code>on_epoch_begin</code>(<strong>**<code>kwargs</code></strong>:<code>Any</code>)</p>
</blockquote>
<div class="collapse" id="BnFreeze-on_epoch_begin-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#BnFreeze-on_epoch_begin-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>on_epoch_begin</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Put bn layers in eval mode just after <code>model.train()</code>.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AccumulateScheduler" class="doc_header"><code>class</code> <code>AccumulateScheduler</code><a href="https://github.com/fastai/fastai/blob/master/fastai/train.py#L109" class="source_link" style="float:right">[source]</a><a class="source_link" data-toggle="collapse" data-target="#AccumulateScheduler-pytest" style="float:right; padding-right:10px">[test]</a></h2><blockquote><p><code>AccumulateScheduler</code>(<strong><code>learn</code></strong>:<a href="/basic_train.html#Learner"><code>Learner</code></a>, <strong><code>n_step</code></strong>:<code>int</code>=<strong><em><code>1</code></em></strong>, <strong><code>drop_last</code></strong>:<code>bool</code>=<strong><em><code>False</code></em></strong>) :: <a href="/basic_train.html#LearnerCallback"><code>LearnerCallback</code></a></p>
</blockquote>
<div class="collapse" id="AccumulateScheduler-pytest"><div class="card card-body pytest_card"><a type="button" data-toggle="collapse" data-target="#AccumulateScheduler-pytest" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></a><p>No tests found for <code>AccumulateScheduler</code>. To contribute a test please refer to <a href="/dev/test.html">this guide</a> and <a href="https://forums.fast.ai/t/improving-expanding-functional-tests/32929">this discussion</a>.</p></div></div><p>Does accumlated step every nth step by accumulating gradients</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's force <code>batch_size=2</code> to mimic a scenario where we can't fit enough batch samples to our memory. We can then set <code>n_step</code> as desired to have an effective batch_size of <code>effective_batch_size=batch_size*n_step</code>.</p>
<p>It is also important to use loss func with <code>reduce='sum'</code> in order to calculate exact average accumulated gradients.</p>
<p>Another important note for users is that <code>batchnorm</code> is not yet adapted to accumulated gradients. So you should use this callback at your own risk until a hero fixes it :)</p>
<p>Here we demonstrate this callback with a model without <code>batchnorm</code> layers, alternatively you can use <code>nn.InstanceNorm</code> or <a href="https://pytorch.org/docs/stable/nn.html#torch.nn.GroupNorm"><code>nn.GroupNorm</code></a>.</p>

<pre><code>from torchvision.models import vgg11

data = ImageDataBunch.from_folder(path, bs=2)

learn = cnn_learner(data, resnet18, metrics=accuracy, loss_func=CrossEntropyFlat(reduction='sum'),
                    callback_fns=partial(AccumulateScheduler, n_step=16))
learn.fit(1)</code></pre>

</div>
</div>
</div>
</div>
 

