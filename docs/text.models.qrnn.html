---

title: QRNN

keywords: fastai
sidebar: home_sidebar

summary: "Quasi-recurrent neural networs introduced in [Bradbury et al.](https://arxiv.org/abs/1611.01576)"
description: "Quasi-recurrent neural networs introduced in [Bradbury et al.](https://arxiv.org/abs/1611.01576)"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/36_text.models.qrnn.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ForgetMult">ForgetMult<a class="anchor-link" href="#ForgetMult"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="vm">__file__</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;fastai2&#39;</span><span class="o">/</span><span class="s1">&#39;text&#39;</span><span class="o">/</span><span class="s1">&#39;models&#39;</span><span class="o">/</span><span class="s1">&#39;qrnn.py&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_cpp" class="doc_header"><code>load_cpp</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/models/qrnn.py#L16" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_cpp</code>(<strong><code>name</code></strong>, <strong><code>files</code></strong>, <strong><code>path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dispatch_cuda" class="doc_header"><code>dispatch_cuda</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/models/qrnn.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dispatch_cuda</code>(<strong><code>cuda_class</code></strong>, <strong><code>cpu_func</code></strong>, <strong><code>x</code></strong>)</p>
</blockquote>
<p>Depending on <code>x.device</code> uses <code>cpu_func</code> or <code>cuda_class.apply</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The ForgetMult gate is the quai-recurrent part of the network, computing the following from <code>x</code> and <code>f</code>.</p>
<div class="highlight"><pre><span></span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
<p>The initial value for <code>h[0]</code> is either a tensor of zeros or the previous hidden state.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="forget_mult_CPU" class="doc_header"><code>forget_mult_CPU</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/models/qrnn.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>forget_mult_CPU</code>(<strong><code>x</code></strong>, <strong><code>f</code></strong>, <strong><code>first_h</code></strong>=<em><code>None</code></em>, <strong><code>batch_first</code></strong>=<em><code>True</code></em>, <strong><code>backward</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>ForgetMult gate applied to <code>x</code> and <code>f</code> on the CPU.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>first_h</code> is the tensor used for the value of <code>h[0]</code> (defaults to a tensor of zeros). If <code>batch_first=True</code>, <code>x</code> and <code>f</code> are expected to be of shape <code>batch_size x seq_length x n_hid</code>, otherwise they are expected to be of shape <code>seq_length x batch_size x n_hid</code>. If <code>backwards=True</code>, the elements in <code>x</code> and <code>f</code> on the sequence dimension are read in reverse.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">manual_forget_mult</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">batch_first</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">f</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">h</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">idx_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">backward</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_range</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">prev</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">batch_first</span><span class="p">:</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">x</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">bf</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[(</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">)]:</span>
    <span class="n">th_out</span> <span class="o">=</span> <span class="n">manual_forget_mult</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="n">bf</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">forget_mult_CPU</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="n">bf</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
    <span class="n">test_close</span><span class="p">(</span><span class="n">th_out</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="mi">5</span> <span class="k">if</span> <span class="n">bf</span> <span class="k">else</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">th_out</span> <span class="o">=</span> <span class="n">manual_forget_mult</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="n">bf</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">forget_mult_CPU</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">first_h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="n">bf</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
    <span class="n">test_close</span><span class="p">(</span><span class="n">th_out</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([3, 4, 5, 0, 1, 0])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="ForgetMultGPU" class="doc_header"><code>class</code> <code>ForgetMultGPU</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/models/qrnn.py#L61" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>ForgetMultGPU</code>() :: <code>Function</code></p>
</blockquote>
<p>Wraper around the CUDA kernels for the ForgetMult gate.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="QRNN">QRNN<a class="anchor-link" href="#QRNN"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="QRNNLayer" class="doc_header"><code>class</code> <code>QRNNLayer</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/models/qrnn.py#L86" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>QRNNLayer</code>(<strong><code>input_size</code></strong>, <strong><code>hidden_size</code></strong>=<em><code>None</code></em>, <strong><code>save_prev_x</code></strong>=<em><code>False</code></em>, <strong><code>zoneout</code></strong>=<em><code>0</code></em>, <strong><code>window</code></strong>=<em><code>1</code></em>, <strong><code>output_gate</code></strong>=<em><code>True</code></em>, <strong><code>batch_first</code></strong>=<em><code>True</code></em>, <strong><code>backward</code></strong>=<em><code>False</code></em>) :: <a href="/torch_core#Module"><code>Module</code></a></p>
</blockquote>
<p>Apply a single layer Quasi-Recurrent Neural Network (QRNN) to an input sequence.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qrnn_fwd</span> <span class="o">=</span> <span class="n">QRNNLayer</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">save_prev_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zoneout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">output_gate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">qrnn_bwd</span> <span class="o">=</span> <span class="n">QRNNLayer</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">save_prev_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zoneout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">output_gate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">qrnn_bwd</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">qrnn_fwd</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
<span class="n">x_fwd</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">x_bwd</span> <span class="o">=</span> <span class="n">x_fwd</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_fwd</span><span class="p">,</span><span class="n">h_fwd</span> <span class="o">=</span> <span class="n">qrnn_fwd</span><span class="p">(</span><span class="n">x_fwd</span><span class="p">)</span>
<span class="n">y_bwd</span><span class="p">,</span><span class="n">h_bwd</span> <span class="o">=</span> <span class="n">qrnn_bwd</span><span class="p">(</span><span class="n">x_bwd</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">y_fwd</span><span class="p">,</span> <span class="n">y_bwd</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">h_fwd</span><span class="p">,</span> <span class="n">h_bwd</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">y_fwd</span><span class="p">,</span><span class="n">h_fwd</span> <span class="o">=</span> <span class="n">qrnn_fwd</span><span class="p">(</span><span class="n">x_fwd</span><span class="p">,</span> <span class="n">h_fwd</span><span class="p">)</span>
<span class="n">y_bwd</span><span class="p">,</span><span class="n">h_bwd</span> <span class="o">=</span> <span class="n">qrnn_bwd</span><span class="p">(</span><span class="n">x_bwd</span><span class="p">,</span> <span class="n">h_bwd</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">y_fwd</span><span class="p">,</span> <span class="n">y_bwd</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">h_fwd</span><span class="p">,</span> <span class="n">h_bwd</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="QRNN" class="doc_header"><code>class</code> <code>QRNN</code><a href="https://github.com/fastai/fastai2/tree/master/fastai2/text/models/qrnn.py#L137" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>QRNN</code>(<strong><code>input_size</code></strong>, <strong><code>hidden_size</code></strong>, <strong><code>n_layers</code></strong>=<em><code>1</code></em>, <strong><code>batch_first</code></strong>=<em><code>True</code></em>, <strong><code>dropout</code></strong>=<em><code>0</code></em>, <strong><code>bidirectional</code></strong>=<em><code>False</code></em>, <strong><code>save_prev_x</code></strong>=<em><code>False</code></em>, <strong><code>zoneout</code></strong>=<em><code>0</code></em>, <strong><code>window</code></strong>=<em><code>None</code></em>, <strong><code>output_gate</code></strong>=<em><code>True</code></em>) :: <a href="/torch_core#Module"><code>Module</code></a></p>
</blockquote>
<p>Apply a multiple layer Quasi-Recurrent Neural Network (QRNN) to an input sequence.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qrnn</span> <span class="o">=</span> <span class="n">QRNN</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">output_gate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">y</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">qrnn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">40</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="c1">#Without an out gate, the last timestamp in the forward output is the second to last hidden</span>
<span class="c1">#and the first timestamp of the backward output is the last hidden</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="mi">20</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">:],</span> <span class="n">h</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

