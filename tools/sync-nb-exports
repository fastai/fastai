#!/usr/bin/env python

# Convert any modified `dev_nb/*.ipynb` with #export tags to `dev_nb/nb_*.py`

# usage: tools/sync-nb-exports

import sys, os, os.path
from pathlib import Path
from pdb import set_trace

if Path.cwd().name != 'dev_nb': os.chdir('dev_nb')
path = Path('.')
sys.path.append('.')
import notebook2script

for file in sorted(path.glob('0*ipynb')):
    fname = str(file)
    fname_out = notebook2script.get_py_fname(fname)

    # skip unmodified notebooks
    if path.joinpath(fname_out).exists():
        in_mod  = os.path.getmtime(fname)
        out_mod = os.path.getmtime(fname_out)
        if in_mod < out_mod: continue

    # autogenerated notebooks have #export in them
    if '#export' in file.read_text():
        #set_trace()
        notebook2script.notebook2script(file)

print('All is up-to-date')
